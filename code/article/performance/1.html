<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue 巨量表单型内容表格优化实践 | 戡玉的个人博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="业精于勤荒于嬉，行成于思毁于随">
    
    <link rel="preload" href="/assets/css/0.styles.e5c8d458.css" as="style"><link rel="preload" href="/assets/js/app.89584af2.js" as="script"><link rel="preload" href="/assets/js/2.b85b6bc1.js" as="script"><link rel="preload" href="/assets/js/30.bb6fddcc.js" as="script"><link rel="prefetch" href="/assets/js/10.f48f662c.js"><link rel="prefetch" href="/assets/js/100.ff3774eb.js"><link rel="prefetch" href="/assets/js/101.f8de727d.js"><link rel="prefetch" href="/assets/js/102.fdd468e2.js"><link rel="prefetch" href="/assets/js/103.9c185187.js"><link rel="prefetch" href="/assets/js/104.ec04e106.js"><link rel="prefetch" href="/assets/js/105.ec2f05ef.js"><link rel="prefetch" href="/assets/js/106.04fa10a3.js"><link rel="prefetch" href="/assets/js/11.a49e6006.js"><link rel="prefetch" href="/assets/js/12.7ff2c931.js"><link rel="prefetch" href="/assets/js/13.6bb5eb8e.js"><link rel="prefetch" href="/assets/js/14.2e9aff51.js"><link rel="prefetch" href="/assets/js/15.5ee936ed.js"><link rel="prefetch" href="/assets/js/16.1241602e.js"><link rel="prefetch" href="/assets/js/17.49ca2bef.js"><link rel="prefetch" href="/assets/js/18.b1bd47e1.js"><link rel="prefetch" href="/assets/js/19.bc10f604.js"><link rel="prefetch" href="/assets/js/20.a53198b4.js"><link rel="prefetch" href="/assets/js/21.a166550c.js"><link rel="prefetch" href="/assets/js/22.3a79ad58.js"><link rel="prefetch" href="/assets/js/23.0d31cbdf.js"><link rel="prefetch" href="/assets/js/24.6126bd11.js"><link rel="prefetch" href="/assets/js/25.68d5f542.js"><link rel="prefetch" href="/assets/js/26.d2ed036c.js"><link rel="prefetch" href="/assets/js/27.5fed1b6c.js"><link rel="prefetch" href="/assets/js/28.4543da2a.js"><link rel="prefetch" href="/assets/js/29.20ceb567.js"><link rel="prefetch" href="/assets/js/3.c44793ab.js"><link rel="prefetch" href="/assets/js/31.a966056c.js"><link rel="prefetch" href="/assets/js/32.6d16ab5b.js"><link rel="prefetch" href="/assets/js/33.aeecee7e.js"><link rel="prefetch" href="/assets/js/34.a1a7b598.js"><link rel="prefetch" href="/assets/js/35.ff6725a9.js"><link rel="prefetch" href="/assets/js/36.1d944e47.js"><link rel="prefetch" href="/assets/js/37.97f3ce4e.js"><link rel="prefetch" href="/assets/js/38.d4143a9b.js"><link rel="prefetch" href="/assets/js/39.bae6154f.js"><link rel="prefetch" href="/assets/js/4.e785d66f.js"><link rel="prefetch" href="/assets/js/40.08c5087a.js"><link rel="prefetch" href="/assets/js/41.71955676.js"><link rel="prefetch" href="/assets/js/42.0d587eef.js"><link rel="prefetch" href="/assets/js/43.797f934e.js"><link rel="prefetch" href="/assets/js/44.845e1d69.js"><link rel="prefetch" href="/assets/js/45.81dae8cd.js"><link rel="prefetch" href="/assets/js/46.01472961.js"><link rel="prefetch" href="/assets/js/47.f95a2836.js"><link rel="prefetch" href="/assets/js/48.167c3cdf.js"><link rel="prefetch" href="/assets/js/49.12858990.js"><link rel="prefetch" href="/assets/js/5.6ba42e98.js"><link rel="prefetch" href="/assets/js/50.a66586b9.js"><link rel="prefetch" href="/assets/js/51.bcb26779.js"><link rel="prefetch" href="/assets/js/52.c50fa8e9.js"><link rel="prefetch" href="/assets/js/53.79f44752.js"><link rel="prefetch" href="/assets/js/54.28197cb3.js"><link rel="prefetch" href="/assets/js/55.cce40a1f.js"><link rel="prefetch" href="/assets/js/56.d877a329.js"><link rel="prefetch" href="/assets/js/57.ac7b286c.js"><link rel="prefetch" href="/assets/js/58.5f705dab.js"><link rel="prefetch" href="/assets/js/59.bc90563e.js"><link rel="prefetch" href="/assets/js/6.3d2d0cab.js"><link rel="prefetch" href="/assets/js/60.d0971935.js"><link rel="prefetch" href="/assets/js/61.b5391bc8.js"><link rel="prefetch" href="/assets/js/62.1818e32a.js"><link rel="prefetch" href="/assets/js/63.2ce76671.js"><link rel="prefetch" href="/assets/js/64.998f03b3.js"><link rel="prefetch" href="/assets/js/65.809f0522.js"><link rel="prefetch" href="/assets/js/66.340b0933.js"><link rel="prefetch" href="/assets/js/67.a7d526be.js"><link rel="prefetch" href="/assets/js/68.9e55b2ed.js"><link rel="prefetch" href="/assets/js/69.cd1d8a95.js"><link rel="prefetch" href="/assets/js/7.a6b1a25b.js"><link rel="prefetch" href="/assets/js/70.17b18a1a.js"><link rel="prefetch" href="/assets/js/71.39cd45c2.js"><link rel="prefetch" href="/assets/js/72.2b727976.js"><link rel="prefetch" href="/assets/js/73.5b0d3207.js"><link rel="prefetch" href="/assets/js/74.f992e12a.js"><link rel="prefetch" href="/assets/js/75.3511b5f6.js"><link rel="prefetch" href="/assets/js/76.45d3a0a8.js"><link rel="prefetch" href="/assets/js/77.b35f1dc0.js"><link rel="prefetch" href="/assets/js/78.8d27ada2.js"><link rel="prefetch" href="/assets/js/79.03333a9e.js"><link rel="prefetch" href="/assets/js/8.005f0859.js"><link rel="prefetch" href="/assets/js/80.20966bb7.js"><link rel="prefetch" href="/assets/js/81.bbad6aa9.js"><link rel="prefetch" href="/assets/js/82.3cadf2db.js"><link rel="prefetch" href="/assets/js/83.5923885a.js"><link rel="prefetch" href="/assets/js/84.bed49f1e.js"><link rel="prefetch" href="/assets/js/85.8ada4cf4.js"><link rel="prefetch" href="/assets/js/86.23c160fc.js"><link rel="prefetch" href="/assets/js/87.f1b16045.js"><link rel="prefetch" href="/assets/js/88.e59d9fbc.js"><link rel="prefetch" href="/assets/js/89.89b26741.js"><link rel="prefetch" href="/assets/js/9.fae1371e.js"><link rel="prefetch" href="/assets/js/90.13a1c791.js"><link rel="prefetch" href="/assets/js/91.0f5f61fa.js"><link rel="prefetch" href="/assets/js/92.c3d39ec4.js"><link rel="prefetch" href="/assets/js/93.a1f64002.js"><link rel="prefetch" href="/assets/js/94.327219d9.js"><link rel="prefetch" href="/assets/js/95.65616f44.js"><link rel="prefetch" href="/assets/js/96.b64f24b5.js"><link rel="prefetch" href="/assets/js/97.dfec418f.js"><link rel="prefetch" href="/assets/js/98.ae73227d.js"><link rel="prefetch" href="/assets/js/99.38cd213e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5c8d458.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">戡玉的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/code/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/code/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>web前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>性能优化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/code/article/performance/1.html" aria-current="page" class="active sidebar-link">vue 巨量表单型内容表格优化实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/article/performance/1.html#背景说明" class="sidebar-link">背景说明</a></li><li class="sidebar-sub-header"><a href="/code/article/performance/1.html#性能问题" class="sidebar-link">性能问题</a></li><li class="sidebar-sub-header"><a href="/code/article/performance/1.html#优化实践" class="sidebar-link">优化实践</a></li><li class="sidebar-sub-header"><a href="/code/article/performance/1.html#实践总结" class="sidebar-link">实践总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>游览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-巨量表单型内容表格优化实践"><a href="#vue-巨量表单型内容表格优化实践" class="header-anchor">#</a> vue 巨量表单型内容表格优化实践</h1> <blockquote><p>项目开发完成的时间是 19 年中旬，但是由于我个人对应用经验总结的疏懒和无兴趣，一直未曾记录，但感觉还是值得一记，遂在今日补上（2020 年 11 月 14 日），加补一次（2021 年 05 月 31 日）。</p></blockquote> <h2 id="背景说明"><a href="#背景说明" class="header-anchor">#</a> 背景说明</h2> <p>该项目开始于 18 年 2 月，19 年 3 月份开始针对表格性能进行页面重构，6 月份最终完成。</p> <h3 id="技术栈"><a href="#技术栈" class="header-anchor">#</a> 技术栈</h3> <p><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer">vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + <a href="https://router.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">vue-router<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + <a href="https://vuex.vuejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">vuex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + <a href="https://element.eleme.io/#/zh-CN/component/installation" target="_blank" rel="noopener noreferrer">element ui<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + <a href="https://d2.pub/zh/doc/d2-admin/" target="_blank" rel="noopener noreferrer">d2-admin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="业务场景"><a href="#业务场景" class="header-anchor">#</a> 业务场景</h3> <p>这是一个包含进销存模块的中后台系统，其中采购和销售模块在做单的时候，会包含很多明细信息，它们作为单据的子信息存在，这样的子信息会有很多，销售模块下的某些单据还需要支持 excel 导入，一条业务单据，可能会出现上百条左右的信息数据，前端界面上通过表单型表格进行展现。</p> <h3 id="业务图示"><a href="#业务图示" class="header-anchor">#</a> 业务图示</h3> <p>这个是销售模块下的零购销售主页，点击单据行后，底部弹出从表信息</p> <p><img src="/code/article/performance/1.png" alt=""></p> <p>点击表格顶部的<strong>新增</strong>按钮，可以新增单据行；点击表格行右侧的<strong>编辑</strong>按钮，可以编辑单据行。</p> <p>这里以编辑为例，随便点击一行的编辑后，进入到子信息内页，可以进行单据内容明细编辑，页面如下：</p> <p><img src="/code/article/performance/2.png" alt=""></p> <p>如图所示，点击表格顶部的<strong>插行</strong>按钮，可以插入表格行；点击<strong>引合同</strong>，可以引入 excel，导入批量数据；点击表格行右侧的<strong>复制</strong>按钮，可以复制一行。</p> <h2 id="性能问题"><a href="#性能问题" class="header-anchor">#</a> 性能问题</h2> <h3 id="发现问题"><a href="#发现问题" class="header-anchor">#</a> 发现问题</h3> <ul><li><p>这个业务场景下的页面可以支持插入大量数据，某些 excel 引入的明细信息有可能上百条。</p></li> <li><p>最开始插入 10 多条数据的时候，体验都还很流畅，但是当插行达到 30 行以上后，开始出现了延迟和卡顿。</p></li> <li><p>这里放上之前测试的数据图——均是等待 20 秒，内存稳定后的情况</p></li></ul> <p><img src="/code/article/performance/3.png" alt=""></p> <h3 id="问题分析"><a href="#问题分析" class="header-anchor">#</a> 问题分析</h3> <ul><li><p>我们都知道，在 vue 里面，一切可视的界面原件都是组件化构成的，element ui 封装了一系列可视化的 vue 组件，每个组件都有它独立的生命周期，运行逻辑和内存绑定。</p></li> <li><p>在这个页面上比较突出的组件就是下拉，体现在单据表格中则是一行拥有 6 个下拉组件，若是表格数据达到 100 行，则光是表格内的下拉就拥有了 600 个。</p></li> <li><p>然后在表格内的品名，材质，规格和产地下拉又比较特殊，属于联动数据，它并不是固定有限的少量数据，其中甚至存在几百条数据，我最后将其封装成了 ajax 搜索版，支持滚动翻页，逐步加载。</p></li> <li><p>翻看 element 的 el-select 组件源码就会发现，它封装了自身的 el-input 组件，做了多选处理，也就是说，每个下拉行即是一个 input 组件，这样下来，整个表格内的组件已经非常多了。</p></li> <li><p>值得一说的是，select 下拉虽然支持远程请求搜索，但是并没有抛出内部滚动的 scroll 事件函数，因此我在做 ajax 搜索翻页封装的时候，改动了下源码</p></li> <li><p>当我将其中的 input 和 select 组件全部去除，以纯文字项做表格行插入时，到 100 条左右后，js 堆内存总共是 300M 左右，总体来讲也还行，只是纯滚动的话。</p></li> <li><p>值得强调的是，当我去掉表格内的 fixed=right 属性时，也就是表格右侧的列固定后，内存直接下降了 150M，翻看源码才发现为了实现这个效果，内部做了浮层表格</p></li> <li><p>从操作系统的角度而言，游览器作为一个桌面应用，它向系统申请到了一定的内存容量，而每个页面的 tab 卡作为进程，又向游览器申请了一定的运行内存，大于可运行的内存指标就会出现不流畅和卡顿。</p></li> <li><p>目前来看，会知觉到不流畅的 js 的堆大小为 200M 以上，如果你电脑配置比较小或者老旧，可能会提早感知到这种卡顿和不畅。</p></li> <li><p>所以，问题主要集中在这种场景下，包含大量表单和下拉的巨量表格行插入，会使得单个 tab 卡进程的内存占用达到一个卡顿峰值，我们需要进行优化。</p></li></ul> <h2 id="优化实践"><a href="#优化实践" class="header-anchor">#</a> 优化实践</h2> <ul><li>这个优化实践有一个时间阶段性，大致的优化过程如下：</li></ul> <h3 id="第一波优化-删减源码"><a href="#第一波优化-删减源码" class="header-anchor">#</a> 第一波优化（删减源码）</h3> <ul><li>翻看 element table，select 和 input 源码，将未用到的一些功能都注销了，但是效果并不明显。</li></ul> <h3 id="第二波优化-简易虚拟列表"><a href="#第二波优化-简易虚拟列表" class="header-anchor">#</a> 第二波优化（简易虚拟列表）</h3> <ul><li><p>当时社区已经有了虚拟列表的方案，版本实现为 react，主要是针对展示列表的显示，内容也是纯文字型，针对 vue 和 element 这种表格行滚动我并未看到有实践方案。</p></li> <li><p>针对这种情况，我自己就简单实现了一个，控制视区内容有限渲染，但是滚动效果并不是很流畅，内存和卡顿倒是实现了，最终方案被业务方 pass。</p></li></ul> <h3 id="第三波优化-重写-el-input-select-组件"><a href="#第三波优化-重写-el-input-select-组件" class="header-anchor">#</a> 第三波优化（重写 el-input/select 组件）</h3> <ul><li><p>我花了一周时间，用 vue 重写了 el-input 和 el-select 组件，实现了 element 界面样式，必要功能和 api， 使用上达到 95%的还原，内部也做好了对 element 表单验证的适配，基本达到了无缝对接，只有 1~2 个属性的增改。</p></li> <li><p>然后进行了试验测试，效果如下——30 条时，内存为 128M；100 条时，内存为 394M</p></li></ul> <p><img src="/code/article/performance/4.png" alt=""></p> <ul><li>虽然在以前 100 数据时的基础上减去了一大半的内存，但是接近 400M 的内存依然卡顿无比，方案作罢。</li></ul> <h3 id="第四波优化-jspreadsheets-库-2019-06"><a href="#第四波优化-jspreadsheets-库-2019-06" class="header-anchor">#</a> 第四波优化（JSpreadsheets 库-2019.06）</h3> <ul><li><p>我们组长找到了一个 excel 插件，叫 JSpreadsheets，直接引入后，内存和第四波优化一致，但是滚动流畅。</p></li> <li><p>唯一的问题是界面偏 excel 风格，然后代码体积较大，有 1w+行 js 代码，2k 行 css 代码，纯原生 js 代码量巨大，改动起来也比较费事。</p></li> <li><p>最后经过多方讨论，采用了这个插件将所有表格单据进行重构，使用上引入了一个对这个插件的 vue 封装套件，然后样式做了些调整，最后改动完的界面如下：</p></li></ul> <p><img src="/code/article/performance/7.png" alt=""></p> <h3 id="第五波优化-pl-table-库-2020-03"><a href="#第五波优化-pl-table-库-2020-03" class="header-anchor">#</a> 第五波优化（pl-table 库 2020.03）</h3> <ul><li><p>随着时间的推移，业务方也觉得 excel 表格方案虽然不影响使用，但是体验感比较生硬，可调整性有限，遂出现替改的声音。</p></li> <li><p>后来我偶尔在社区发现了比较成熟的针对 element 表格的虚拟表格方案，也就是 pl-table 组件，应用后如下图所示**（30 条时，内存为 55M；100 条时，内存为 247M）**</p></li></ul> <p><img src="/code/article/performance/5.png" alt=""></p> <ul><li>然后当去除右侧固定的 fixed=right 属性后，内存又降了一波**（30 条时，内存为 52.5M；100 条时，内存为 100M）**</li></ul> <p><img src="/code/article/performance/6.png" alt=""></p> <ul><li><p>虽然内存已经降至可接受范围，但是每次滚动的时候，还是会觉得不太流畅，CPU 容易飙高，内存也逐步增加，停顿后逐步下降。</p></li> <li><p>最后经过讨论，这种替改方案还是不满足要求。</p></li></ul> <h3 id="第六波优化-原生-js-插件-2021-4"><a href="#第六波优化-原生-js-插件-2021-4" class="header-anchor">#</a> 第六波优化（原生 js 插件 2021.4）</h3> <ul><li><p>这波优化是基于 JSpreadsheets 插件太过庞大，可定制性和灵活度不够，考虑到后期项目类似的业务要求，在诸多方案无果后，遂打算用原生 js 实现这种业务插件。</p></li> <li><p>我个人历时 1 个月，完成了插件初版，实现了原有业务需要的全部功能，然后断断续续 1 个月优化了插件的功能 bug 和性能，成功替换了一个项目内的表格页面，通过了测试组的项目测试。</p></li></ul> <h2 id="实践总结"><a href="#实践总结" class="header-anchor">#</a> 实践总结</h2> <ul><li><p><strong>目前的插件代码个人并不满意</strong>。因为前期碍于快速出成果，开发中很难很好地兼顾设计与进度，很多代码区块在可读性和性能上都还可以进行优化，尤其是内置的 zepto 还没有剥离，存在原生和$混写的情况，尽管我剥离了 zepto 的无用模块，同时，很多业务场景和性能优化是相悖的，你需要想各种办法来调整，改善和规避，需要时间去思考和拿捏。总的来说，想快而好确实比较难，后面有时间再优化了。</p></li> <li><p><strong>开发这个原生表格控件让我收获颇丰</strong>。在开发过程中，我参考了一些插件的拆分设计，借鉴并用 es6 的方式实现了，同时在具体的功能实现中，我参看了 element-table 源码的实现方式和细节，借鉴了很多思路方法；在优化过程中，又充分发挥了之前学的游览器原理的知识，能分析并找到性能瓶颈，知道如何调整和优化它。</p></li> <li><p><strong>虚拟列表技术可以解决问题</strong>。到目前，虚拟列表的技术已经越来越成熟，在开发表格的过程中，我有一次好奇的看了一波原理分析和 vue 实现，觉得非常精巧，只能说当时个人的能力受限，在实现细节和考虑上不够到位，导致最初实现的版本体验效果不够好。</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/code/article/javascript/11.html" class="prev">
        javascript 实用代码片段
      </a></span> <span class="next"><a href="/code/article/browser/1.html">
        游览器的进程和线程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.89584af2.js" defer></script><script src="/assets/js/2.b85b6bc1.js" defer></script><script src="/assets/js/30.bb6fddcc.js" defer></script>
  </body>
</html>
