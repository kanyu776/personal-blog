<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>core 模块 | 戡玉的个人博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="业精于勤荒于嬉，行成于思毁于随">
    
    <link rel="preload" href="/personal-blog/assets/css/0.styles.196d8624.css" as="style"><link rel="preload" href="/personal-blog/assets/js/app.8eae075c.js" as="script"><link rel="preload" href="/personal-blog/assets/js/2.b85b6bc1.js" as="script"><link rel="preload" href="/personal-blog/assets/js/33.2414377b.js" as="script"><link rel="prefetch" href="/personal-blog/assets/js/10.bab3bca2.js"><link rel="prefetch" href="/personal-blog/assets/js/100.ff3774eb.js"><link rel="prefetch" href="/personal-blog/assets/js/101.f8de727d.js"><link rel="prefetch" href="/personal-blog/assets/js/102.82344b52.js"><link rel="prefetch" href="/personal-blog/assets/js/103.53d3e10f.js"><link rel="prefetch" href="/personal-blog/assets/js/104.ec04e106.js"><link rel="prefetch" href="/personal-blog/assets/js/105.ec2f05ef.js"><link rel="prefetch" href="/personal-blog/assets/js/106.04fa10a3.js"><link rel="prefetch" href="/personal-blog/assets/js/11.825589ef.js"><link rel="prefetch" href="/personal-blog/assets/js/12.c95be7c8.js"><link rel="prefetch" href="/personal-blog/assets/js/13.6bb5eb8e.js"><link rel="prefetch" href="/personal-blog/assets/js/14.0c21a669.js"><link rel="prefetch" href="/personal-blog/assets/js/15.b0eb6116.js"><link rel="prefetch" href="/personal-blog/assets/js/16.9c6e4879.js"><link rel="prefetch" href="/personal-blog/assets/js/17.8cc42dcc.js"><link rel="prefetch" href="/personal-blog/assets/js/18.87dfe70e.js"><link rel="prefetch" href="/personal-blog/assets/js/19.d3ef1708.js"><link rel="prefetch" href="/personal-blog/assets/js/20.d1d470f0.js"><link rel="prefetch" href="/personal-blog/assets/js/21.65ea41ad.js"><link rel="prefetch" href="/personal-blog/assets/js/22.8a81b932.js"><link rel="prefetch" href="/personal-blog/assets/js/23.39803058.js"><link rel="prefetch" href="/personal-blog/assets/js/24.7b1b14b2.js"><link rel="prefetch" href="/personal-blog/assets/js/25.0ba9582f.js"><link rel="prefetch" href="/personal-blog/assets/js/26.a93c29d3.js"><link rel="prefetch" href="/personal-blog/assets/js/27.058b6e47.js"><link rel="prefetch" href="/personal-blog/assets/js/28.9a9682ff.js"><link rel="prefetch" href="/personal-blog/assets/js/29.5371f7ff.js"><link rel="prefetch" href="/personal-blog/assets/js/3.c44793ab.js"><link rel="prefetch" href="/personal-blog/assets/js/30.ff927380.js"><link rel="prefetch" href="/personal-blog/assets/js/31.57ed7352.js"><link rel="prefetch" href="/personal-blog/assets/js/32.4647aef0.js"><link rel="prefetch" href="/personal-blog/assets/js/34.11dc0949.js"><link rel="prefetch" href="/personal-blog/assets/js/35.4d061d51.js"><link rel="prefetch" href="/personal-blog/assets/js/36.c0fa099a.js"><link rel="prefetch" href="/personal-blog/assets/js/37.4f5241d0.js"><link rel="prefetch" href="/personal-blog/assets/js/38.d4143a9b.js"><link rel="prefetch" href="/personal-blog/assets/js/39.cbf8706b.js"><link rel="prefetch" href="/personal-blog/assets/js/4.259d316e.js"><link rel="prefetch" href="/personal-blog/assets/js/40.0e604561.js"><link rel="prefetch" href="/personal-blog/assets/js/41.a1534c49.js"><link rel="prefetch" href="/personal-blog/assets/js/42.0d587eef.js"><link rel="prefetch" href="/personal-blog/assets/js/43.5cc8c98d.js"><link rel="prefetch" href="/personal-blog/assets/js/44.3c99b17d.js"><link rel="prefetch" href="/personal-blog/assets/js/45.344a2af8.js"><link rel="prefetch" href="/personal-blog/assets/js/46.01472961.js"><link rel="prefetch" href="/personal-blog/assets/js/47.444aebbd.js"><link rel="prefetch" href="/personal-blog/assets/js/48.632cd1e7.js"><link rel="prefetch" href="/personal-blog/assets/js/49.33be5536.js"><link rel="prefetch" href="/personal-blog/assets/js/5.deb8d1a0.js"><link rel="prefetch" href="/personal-blog/assets/js/50.606a2040.js"><link rel="prefetch" href="/personal-blog/assets/js/51.05f600f7.js"><link rel="prefetch" href="/personal-blog/assets/js/52.3014bb9a.js"><link rel="prefetch" href="/personal-blog/assets/js/53.20d8d668.js"><link rel="prefetch" href="/personal-blog/assets/js/54.9018d328.js"><link rel="prefetch" href="/personal-blog/assets/js/55.45598492.js"><link rel="prefetch" href="/personal-blog/assets/js/56.fdf84c1e.js"><link rel="prefetch" href="/personal-blog/assets/js/57.c76e2e74.js"><link rel="prefetch" href="/personal-blog/assets/js/58.eaea0a62.js"><link rel="prefetch" href="/personal-blog/assets/js/59.b90b8b20.js"><link rel="prefetch" href="/personal-blog/assets/js/6.3d2d0cab.js"><link rel="prefetch" href="/personal-blog/assets/js/60.d0971935.js"><link rel="prefetch" href="/personal-blog/assets/js/61.61cec365.js"><link rel="prefetch" href="/personal-blog/assets/js/62.71b24778.js"><link rel="prefetch" href="/personal-blog/assets/js/63.629db0e5.js"><link rel="prefetch" href="/personal-blog/assets/js/64.2c6aa57e.js"><link rel="prefetch" href="/personal-blog/assets/js/65.6e809847.js"><link rel="prefetch" href="/personal-blog/assets/js/66.6013dc5e.js"><link rel="prefetch" href="/personal-blog/assets/js/67.149d811b.js"><link rel="prefetch" href="/personal-blog/assets/js/68.b9b54b8e.js"><link rel="prefetch" href="/personal-blog/assets/js/69.acd1d986.js"><link rel="prefetch" href="/personal-blog/assets/js/7.8a0c691b.js"><link rel="prefetch" href="/personal-blog/assets/js/70.41b336f0.js"><link rel="prefetch" href="/personal-blog/assets/js/71.41207ba7.js"><link rel="prefetch" href="/personal-blog/assets/js/72.771d5928.js"><link rel="prefetch" href="/personal-blog/assets/js/73.3e4e9451.js"><link rel="prefetch" href="/personal-blog/assets/js/74.f992e12a.js"><link rel="prefetch" href="/personal-blog/assets/js/75.10091b4a.js"><link rel="prefetch" href="/personal-blog/assets/js/76.00accf95.js"><link rel="prefetch" href="/personal-blog/assets/js/77.2b4d5166.js"><link rel="prefetch" href="/personal-blog/assets/js/78.46db8679.js"><link rel="prefetch" href="/personal-blog/assets/js/79.26e0c54e.js"><link rel="prefetch" href="/personal-blog/assets/js/8.a081ae6a.js"><link rel="prefetch" href="/personal-blog/assets/js/80.f72a7a66.js"><link rel="prefetch" href="/personal-blog/assets/js/81.e18a09e7.js"><link rel="prefetch" href="/personal-blog/assets/js/82.ddbfcc86.js"><link rel="prefetch" href="/personal-blog/assets/js/83.9e64ea56.js"><link rel="prefetch" href="/personal-blog/assets/js/84.91ca4865.js"><link rel="prefetch" href="/personal-blog/assets/js/85.c464b716.js"><link rel="prefetch" href="/personal-blog/assets/js/86.23c160fc.js"><link rel="prefetch" href="/personal-blog/assets/js/87.4ae1aecd.js"><link rel="prefetch" href="/personal-blog/assets/js/88.7450a3d3.js"><link rel="prefetch" href="/personal-blog/assets/js/89.e2e6f0fc.js"><link rel="prefetch" href="/personal-blog/assets/js/9.4f397964.js"><link rel="prefetch" href="/personal-blog/assets/js/90.0475b297.js"><link rel="prefetch" href="/personal-blog/assets/js/91.2c895556.js"><link rel="prefetch" href="/personal-blog/assets/js/92.28dda5ea.js"><link rel="prefetch" href="/personal-blog/assets/js/93.00e90601.js"><link rel="prefetch" href="/personal-blog/assets/js/94.c153f9e1.js"><link rel="prefetch" href="/personal-blog/assets/js/95.4fea4bbf.js"><link rel="prefetch" href="/personal-blog/assets/js/96.dbabeeae.js"><link rel="prefetch" href="/personal-blog/assets/js/97.dfec418f.js"><link rel="prefetch" href="/personal-blog/assets/js/98.3494a8dd.js"><link rel="prefetch" href="/personal-blog/assets/js/99.7da7ab72.js">
    <link rel="stylesheet" href="/personal-blog/assets/css/0.styles.196d8624.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/personal-blog/" class="home-link router-link-active"><!----> <span class="site-name">戡玉的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/personal-blog/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/personal-blog/code/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/personal-blog/about/" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/personal-blog/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/personal-blog/code/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/personal-blog/about/" class="nav-link">
  关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>web前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>游览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>源码分析</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/personal-blog/code/article/source-code/zepto/1" class="sidebar-heading clickable open"><span>zepto</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/personal-blog/code/article/source-code/zepto/1.html" class="sidebar-link">整体架构</a></li><li><a href="/personal-blog/code/article/source-code/zepto/2.html" aria-current="page" class="active sidebar-link">core 模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/personal-blog/code/article/source-code/zepto/2.html#准备说明" class="sidebar-link">准备说明</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/source-code/zepto/2.html#实现内容" class="sidebar-link">实现内容</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/source-code/zepto/2.html#重点分析" class="sidebar-link">重点分析</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/source-code/zepto/2.html#其他-api-方法" class="sidebar-link">其他 api 方法</a></li></ul></li><li><a href="/personal-blog/code/article/source-code/zepto/3.html" class="sidebar-link">event 模块</a></li><li><a href="/personal-blog/code/article/source-code/zepto/4.html" class="sidebar-link">ajax 模块</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="core-模块"><a href="#core-模块" class="header-anchor">#</a> core 模块</h1> <h2 id="准备说明"><a href="#准备说明" class="header-anchor">#</a> 准备说明</h2> <ul><li><p>该模块定义了库的原型链结构，生成了 Zepto 变量，并将其以'Zepto'和'$'的名字注册到了 window，然后开始了其它模块的拓展实现。</p></li> <li><p>模块内部除了对选择器和 zepto 对象的实现，就是一些工具方法和原型方法的定义。</p></li> <li><p>值得一提的是，内部很多实现都利用了原生数组的方法，很多 api 也是基于内部或公开的方法进一步拓展实现的。</p></li> <li><p>虽然该模块涉及的 api 非常多，但内部实现上比较统一，因此只会针对性地挑一些方法进行分析。</p></li></ul> <h2 id="实现内容"><a href="#实现内容" class="header-anchor">#</a> 实现内容</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Zepto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.基础变量定义</span>
    <span class="token comment">// 2.内部方法实现</span>
    <span class="token comment">// 3.zepto对象实现——$('选择器')</span>
    <span class="token comment">// 4.$.extend方法实现</span>
    <span class="token comment">// 5.zepto.qsa内部方法和其它5个内部方法</span>
    <span class="token comment">// 6.全局方法实现——$.方法</span>
    <span class="token comment">// 7.原型方法实现——$().方法</span>
    <span class="token comment">// 8.原型链结构设置</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>上面是主体实现内容，代码定义顺序大致如上，某些地方会穿插定义</li></ul> <h2 id="重点分析"><a href="#重点分析" class="header-anchor">#</a> 重点分析</h2> <h3 id="选择器"><a href="#选择器" class="header-anchor">#</a> 选择器</h3> <p>选择器的实现逻辑放在了 zepto.init 方法中，由$()内部调用 zepto.init 方法，先处理选择器生成 dom 集合，然后将集合传入能生成 zepto 对象的内部方法，主体逻辑如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>zepto<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.如果selector为空</span>
  <span class="token comment">// 2.如果selector为字符串</span>
  <span class="token comment">// a.标签字符串形式</span>
  <span class="token comment">// b.context存在的处理</span>
  <span class="token comment">// c.css选择器</span>
  <span class="token comment">// 3.如果selector为方法</span>
  <span class="token comment">// 4.如果selector为zepto对象</span>
  <span class="token comment">// 5.如果selector为其它情况</span>
  <span class="token comment">// 6.执行zepto对象生成方法</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="源码如下"><a href="#源码如下" class="header-anchor">#</a> 源码如下</h3> <div class="language-js extra-class"><pre class="language-js"><code>zepto<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> dom<span class="token punctuation">;</span>
  <span class="token comment">// 如果selector不存在(返回一个空的zepto对象)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selector<span class="token punctuation">)</span> <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token constant">Z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果selector为字符串</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> selector <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    selector <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果是标签字符串形式(在Chrome 21 and Firefox 15中，如果选择器不以'&lt;'开头，会引发dom错误)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;&lt;&quot;</span> <span class="token operator">&amp;&amp;</span> fragmentRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>selector <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果存在context属性，则应该以它为基础往下查找</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果是css选择器</span>
    <span class="token keyword">else</span> dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">qsa</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果selector是方法</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果是zepto对象(直接返回)</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>zepto<span class="token punctuation">.</span><span class="token function">isZ</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> selector<span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是本身数组，则去掉不存在的</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> dom <span class="token operator">=</span> <span class="token function">compact</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果是对象，则存为数组形式</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>dom <span class="token operator">=</span> <span class="token punctuation">[</span>selector<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>selector <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里重复了typeof selector == 'string'时的判断</span>
    <span class="token comment">// 因为typeof无法让new String()包装类型进入条件，因此通过最后的else再进行一次判断</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>fragmentRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span>dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>selector <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">qsa</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建zepto集合</span>
  <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token constant">Z</span><span class="token punctuation">(</span>dom<span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="zepto-qsa-方法"><a href="#zepto-qsa-方法" class="header-anchor">#</a> zepto.qsa 方法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 处理css选择器的情况</span>
zepto<span class="token punctuation">.</span><span class="token function-variable function">qsa</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> found<span class="token punctuation">,</span>
    maybeID <span class="token operator">=</span> selector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;#&quot;</span><span class="token punctuation">,</span>
    maybeClass <span class="token operator">=</span> <span class="token operator">!</span>maybeID <span class="token operator">&amp;&amp;</span> selector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
    nameOnly <span class="token operator">=</span> maybeID <span class="token operator">||</span> maybeClass <span class="token operator">?</span> selector<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> selector<span class="token punctuation">,</span>
    <span class="token comment">// 是否为单一形式的选择器而非复杂形式</span>
    isSimple <span class="token operator">=</span> simpleSelectorRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>nameOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> element<span class="token punctuation">.</span>getElementById <span class="token operator">&amp;&amp;</span> isSimple <span class="token operator">&amp;&amp;</span> maybeID <span class="token comment">// Safari游览器的DocumentFrament没有getElementById方法</span>
    <span class="token operator">?</span> <span class="token comment">// id选择器处理</span>
      <span class="token punctuation">(</span>found <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>nameOnly<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token operator">?</span> <span class="token punctuation">[</span>found<span class="token punctuation">]</span>
      <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token operator">:</span> <span class="token comment">// 非id选择器处理</span>
    element<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">11</span>
    <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token operator">:</span> <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
        isSimple <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>maybeID <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>getElementsByClassName <span class="token comment">// DocumentFragment没有getElementsByClassName/TagName方法</span>
          <span class="token operator">?</span> maybeClass
            <span class="token operator">?</span> element<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span>nameOnly<span class="token punctuation">)</span> <span class="token comment">// 如果是class</span>
            <span class="token operator">:</span> element<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token comment">// 如果是标签</span>
          <span class="token operator">:</span> element<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token comment">// 其它都用querySelectorAll处理</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="zepto-fragment-方法"><a href="#zepto-fragment-方法" class="header-anchor">#</a> zepto.fragment 方法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 处理标签字符串的情况</span>
zepto<span class="token punctuation">.</span><span class="token function-variable function">fragment</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html<span class="token punctuation">,</span> name<span class="token punctuation">,</span> properties</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> dom<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> container<span class="token punctuation">;</span>
  <span class="token comment">// 如果是无标签内容的标签，则直接创建并赋值给dom变量</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>singleTagRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span> dom <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果是有内容的标签，则走其他的判断流程</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 保证标签字符串为双标签形式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>html<span class="token punctuation">.</span>replace<span class="token punctuation">)</span> html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>tagExpanderRE<span class="token punctuation">,</span> <span class="token string">&quot;&lt;$1&gt;&lt;/$2&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果没有从html字符串中获取到标签名，则再次获取</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> name <span class="token operator">=</span> fragmentRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> RegExp<span class="token punctuation">.</span>$1<span class="token punctuation">;</span>
    <span class="token comment">// 如果标签名为非常规字符串，则name置为'*'，容器container设置为div</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>name <span class="token keyword">in</span> containers<span class="token punctuation">)</span><span class="token punctuation">)</span> name <span class="token operator">=</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过容器标签将html字符串dom化</span>
    container <span class="token operator">=</span> containers<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> html<span class="token punctuation">;</span>
    <span class="token comment">// 返回dom集合，清空container</span>
    dom <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      container<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果是纯粹的object对象</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nodes <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果是库的特殊属性名，则应该通过方法调用</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>methodAttributes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> nodes<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 如果不是，则设置集合的节点属性</span>
      <span class="token keyword">else</span> nodes<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> dom<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="zepto-对象"><a href="#zepto-对象" class="header-anchor">#</a> zepto 对象</h3> <p>Zepto 对象的生成依赖于一连串相关的内部方法，源码实现如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// zepto对象工厂————第四步</span>
<span class="token keyword">function</span> <span class="token constant">Z</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">,</span>
    len <span class="token operator">=</span> dom <span class="token operator">?</span> dom<span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dom<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">=</span> len<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>selector <span class="token operator">=</span> selector <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 处理标签字符串</span>
zepto<span class="token punctuation">.</span><span class="token function-variable function">fragment</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html<span class="token punctuation">,</span> name<span class="token punctuation">,</span> properties</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 源码不再赘述...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 生成zepto对象————第三步</span>
zepto<span class="token punctuation">.</span><span class="token function-variable function">Z</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过模块的原型链结构，可获得各种操作方法</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Z</span><span class="token punctuation">(</span>dom<span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 判断是否为zepto对象</span>
zepto<span class="token punctuation">.</span><span class="token function-variable function">isZ</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> object <span class="token keyword">instanceof</span> <span class="token class-name">zepto<span class="token punctuation">.</span>Z</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 生成dom集合，然后进行zepto集合创建————第二步</span>
zepto<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 生成dom集合</span>
  <span class="token comment">// 执行zepto.Z方法</span>
  <span class="token comment">// 源码不再赘述...</span>
  <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token constant">Z</span><span class="token punctuation">(</span>dom<span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 获取zepto对象————第一步</span>
<span class="token function-variable function">$</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 处理css选择器</span>
zepto<span class="token punctuation">.</span><span class="token function-variable function">qsa</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 源码不再赘述...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 设置原型方法</span>
$<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 设置原型链结构</span>
zepto<span class="token punctuation">.</span><span class="token class-name">Z</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">Z</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> $<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>

<span class="token comment">// 返回给外部Zepto变量，然后通过window注册</span>
<span class="token keyword">return</span> $<span class="token punctuation">;</span>
</code></pre></div><h2 id="其他-api-方法"><a href="#其他-api-方法" class="header-anchor">#</a> 其他 api 方法</h2> <ul><li><p>工具方法和原型方法太多，只能挑几个典型了</p></li> <li><p>extend 和 ready 的实现都比较简单</p></li> <li><p>css 方法的实现主要还是对原生 element.style 和 getComputedStyle 的熟悉，对属性名转换和样式单位的自动添加的考虑</p></li> <li><p>插入操作的几个方法实现比较精巧，可以认真研究下</p></li></ul> <h3 id="extend"><a href="#extend" class="header-anchor">#</a> $.extend</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> source<span class="token punctuation">,</span> deep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果是深拷贝</span>
  <span class="token comment">// isArray判断是否为数组类型</span>
  <span class="token comment">// isPlainObject判断是否为纯粹的object类型</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> source<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deep <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isArray</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果拷贝对象的属性值为Object，而目标对象的属性值不为Object，则目标对象的属性值重置为Object</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 如果拷贝对象的属性值为Array，而目标对象的属性值不为Array，则目标对象的属性值重置为Array</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 进行深拷贝</span>
      <span class="token function">extend</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> deep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果是浅拷贝</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

$<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> deep<span class="token punctuation">,</span>
    args <span class="token operator">=</span> <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果存在深/浅拷贝设置</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">==</span> <span class="token string">&quot;boolean&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 存储深浅拷贝判断值</span>
    deep <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token comment">// 获得目标对象</span>
    target <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 遍历拷贝对象</span>
  args<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">extend</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> arg<span class="token punctuation">,</span> deep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fn-ready"><a href="#fn-ready" class="header-anchor">#</a> $.fn.ready</h3> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">ready</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要检查IE是否存在document.body，因为浏览器在尚未创建body元素时会报告文档就绪</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>readyRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
        <span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">callback</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token boolean">false</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fn-css"><a href="#fn-css" class="header-anchor">#</a> $.fn.css</h3> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">css</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">property<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是获取属性(参数小于2)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 取第一个元素</span>
      <span class="token keyword">var</span> element <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 如果是字符串类型</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> property <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>element<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">// element.style用于访问直接样式，getComputedStyle用于访问层叠后的样式</span>
        <span class="token comment">// camelize方法用于将a-b，转换aB，驼峰转换</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          element<span class="token punctuation">.</span>style<span class="token punctuation">[</span><span class="token function">camelize</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">||</span>
          <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果是数组类型</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>element<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 存储层叠样式集</span>
        <span class="token keyword">var</span> computedStyle <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历数组样式名，生成样式对象props返回</span>
        $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          props<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span>
            element<span class="token punctuation">.</span>style<span class="token punctuation">[</span><span class="token function">camelize</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">||</span>
            computedStyle<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> props<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> css <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果属性值不存在，遍历删除</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">removeProperty</span><span class="token punctuation">(</span><span class="token function">dasherize</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// dasherize用于将property规范化为'a-b'形式</span>
      <span class="token comment">// maybeAddPx用于自动增加px</span>
      <span class="token keyword">else</span> css <span class="token operator">=</span> <span class="token function">dasherize</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">maybeAddPx</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果属性值不存在，遍历删除</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> property<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>property<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">removeProperty</span><span class="token punctuation">(</span><span class="token function">dasherize</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> css <span class="token operator">+=</span> <span class="token function">dasherize</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">maybeAddPx</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> property<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 遍历设置样式字符串</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">+=</span> <span class="token string">&quot;;&quot;</span> <span class="token operator">+</span> css<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="fn-插入"><a href="#fn-插入" class="header-anchor">#</a> $.fn.插入</h3> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 递归执行节点处理函数</span>
    <span class="token keyword">function</span> <span class="token function">traverseNode</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> fun</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fun</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token function">traverseNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fun<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// after|before|append|prepend与insertAfter|insertBefore|appendTo|prepend实现</span>
    <span class="token comment">// adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ]</span>
    adjacencyOperators<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">operator<span class="token punctuation">,</span> operatorIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// inside为0和2, after|before(标签外插入)</span>
      <span class="token comment">// inside为1和3, append|prepend(标签内插入)</span>
      <span class="token keyword">var</span> inside <span class="token operator">=</span> operatorIndex <span class="token operator">%</span> <span class="token number">2</span>

      <span class="token comment">// after|before|append|prepend实现</span>
      $<span class="token punctuation">.</span>fn<span class="token punctuation">[</span>operator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 获得dom数组</span>
        <span class="token keyword">var</span> argType<span class="token punctuation">,</span> nodes <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token comment">// 判断参数项类型</span>
              argType <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
              <span class="token comment">// 如果是array类型，处理成dom数组返回</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>argType <span class="token operator">==</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                arg<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 如果el是dom对象</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
                  <span class="token comment">// 如果el是zepto对象</span>
                  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">.</span>zepto<span class="token punctuation">.</span><span class="token function">isZ</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token comment">// 如果el是标签字符串</span>
                  arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>zepto<span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> arr
              <span class="token punctuation">}</span>
              <span class="token comment">// 如果为object类型或不为null，就返回自身；否则作为标签字符串处理，返回dom</span>
              <span class="token keyword">return</span> argType <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">||</span> arg <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span>
                <span class="token literal-property property">arg</span> <span class="token operator">:</span> zepto<span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            parent<span class="token punctuation">,</span> copyByClone <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span>

        <span class="token comment">// 如果不存在，则返回自身</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodes<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span>

        <span class="token comment">// 处理dom数组</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// inside为0和2, 处理的是after|before, 用父级做容器</span>
          <span class="token comment">// inside为1和3, 处理的是append|prepend, 用自身做容器</span>
          parent <span class="token operator">=</span> inside <span class="token operator">?</span> target <span class="token operator">:</span> target<span class="token punctuation">.</span>parentNode
          <span class="token comment">// target在insertBefore方法中用作参照点</span>
          <span class="token comment">// operatorIndex == 0, 操作的是after方法, 取下一个节点</span>
          <span class="token comment">// operatorIndex == 1, 操作的是prepend方法, 取第一个子节点</span>
          <span class="token comment">// operatorIndex == 2, 操作的是before方法, 取自身</span>
          <span class="token comment">// operatorIndex == 3, 操作的是append方法, 取null</span>
          target <span class="token operator">=</span> operatorIndex <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> target<span class="token punctuation">.</span>nextSibling <span class="token operator">:</span>
                   operatorIndex <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> target<span class="token punctuation">.</span>firstChild <span class="token operator">:</span>
                   operatorIndex <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> target <span class="token operator">:</span>
                   <span class="token keyword">null</span>
          <span class="token comment">// 是否在html内</span>
          <span class="token keyword">var</span> parentInDocument <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>
          <span class="token comment">// 遍历处理插入的节点</span>
          nodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 因为操作对象可能有多个, 而被插入node只有1个</span>
            <span class="token comment">// 如果要让所有操作对象都被插入内容，需要对插入node进行深克隆</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>copyByClone<span class="token punctuation">)</span> node <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token comment">// 如果不存在parent，则删除插入的节点</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parent<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 插入节点</span>
            parent<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
            <span class="token comment">// 如果在html内，就递归执行，遇到有js代码的script标签，就执行它</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>parentInDocument<span class="token punctuation">)</span> <span class="token function">traverseNode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>nodeName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'SCRIPT'</span> <span class="token operator">&amp;&amp;</span>
                 <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>type <span class="token operator">||</span> el<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'text/javascript'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>el<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 这里用到ownerDocument判断而不直接用window，是考虑到页面有可能是iframe引入的</span>
                <span class="token keyword">var</span> target <span class="token operator">=</span> el<span class="token punctuation">.</span>ownerDocument <span class="token operator">?</span> el<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">.</span>defaultView <span class="token operator">:</span> window
                target<span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// insertAfter|insertBefore|appendTo|prepend实现</span>
      $<span class="token punctuation">.</span>fn<span class="token punctuation">[</span>inside <span class="token operator">?</span> operator<span class="token operator">+</span><span class="token string">'To'</span> <span class="token operator">:</span> <span class="token string">'insert'</span><span class="token operator">+</span><span class="token punctuation">(</span>operatorIndex <span class="token operator">?</span> <span class="token string">'Before'</span> <span class="token operator">:</span> <span class="token string">'After'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">[</span>operator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/personal-blog/code/article/source-code/zepto/1.html" class="prev">
        整体架构
      </a></span> <span class="next"><a href="/personal-blog/code/article/source-code/zepto/3.html">
        event 模块
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/personal-blog/assets/js/app.8eae075c.js" defer></script><script src="/personal-blog/assets/js/2.b85b6bc1.js" defer></script><script src="/personal-blog/assets/js/33.2414377b.js" defer></script>
  </body>
</html>
