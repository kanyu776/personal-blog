<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>npm 相关知识整理 | 戡玉的个人博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="业精于勤荒于嬉，行成于思毁于随">
    
    <link rel="preload" href="/personal-blog/assets/css/0.styles.196d8624.css" as="style"><link rel="preload" href="/personal-blog/assets/js/app.8eae075c.js" as="script"><link rel="preload" href="/personal-blog/assets/js/2.b85b6bc1.js" as="script"><link rel="preload" href="/personal-blog/assets/js/17.8cc42dcc.js" as="script"><link rel="prefetch" href="/personal-blog/assets/js/10.bab3bca2.js"><link rel="prefetch" href="/personal-blog/assets/js/100.ff3774eb.js"><link rel="prefetch" href="/personal-blog/assets/js/101.f8de727d.js"><link rel="prefetch" href="/personal-blog/assets/js/102.82344b52.js"><link rel="prefetch" href="/personal-blog/assets/js/103.53d3e10f.js"><link rel="prefetch" href="/personal-blog/assets/js/104.ec04e106.js"><link rel="prefetch" href="/personal-blog/assets/js/105.ec2f05ef.js"><link rel="prefetch" href="/personal-blog/assets/js/106.04fa10a3.js"><link rel="prefetch" href="/personal-blog/assets/js/11.825589ef.js"><link rel="prefetch" href="/personal-blog/assets/js/12.c95be7c8.js"><link rel="prefetch" href="/personal-blog/assets/js/13.6bb5eb8e.js"><link rel="prefetch" href="/personal-blog/assets/js/14.0c21a669.js"><link rel="prefetch" href="/personal-blog/assets/js/15.b0eb6116.js"><link rel="prefetch" href="/personal-blog/assets/js/16.9c6e4879.js"><link rel="prefetch" href="/personal-blog/assets/js/18.87dfe70e.js"><link rel="prefetch" href="/personal-blog/assets/js/19.d3ef1708.js"><link rel="prefetch" href="/personal-blog/assets/js/20.d1d470f0.js"><link rel="prefetch" href="/personal-blog/assets/js/21.65ea41ad.js"><link rel="prefetch" href="/personal-blog/assets/js/22.8a81b932.js"><link rel="prefetch" href="/personal-blog/assets/js/23.39803058.js"><link rel="prefetch" href="/personal-blog/assets/js/24.7b1b14b2.js"><link rel="prefetch" href="/personal-blog/assets/js/25.0ba9582f.js"><link rel="prefetch" href="/personal-blog/assets/js/26.a93c29d3.js"><link rel="prefetch" href="/personal-blog/assets/js/27.058b6e47.js"><link rel="prefetch" href="/personal-blog/assets/js/28.9a9682ff.js"><link rel="prefetch" href="/personal-blog/assets/js/29.5371f7ff.js"><link rel="prefetch" href="/personal-blog/assets/js/3.c44793ab.js"><link rel="prefetch" href="/personal-blog/assets/js/30.ff927380.js"><link rel="prefetch" href="/personal-blog/assets/js/31.57ed7352.js"><link rel="prefetch" href="/personal-blog/assets/js/32.4647aef0.js"><link rel="prefetch" href="/personal-blog/assets/js/33.2414377b.js"><link rel="prefetch" href="/personal-blog/assets/js/34.11dc0949.js"><link rel="prefetch" href="/personal-blog/assets/js/35.4d061d51.js"><link rel="prefetch" href="/personal-blog/assets/js/36.c0fa099a.js"><link rel="prefetch" href="/personal-blog/assets/js/37.4f5241d0.js"><link rel="prefetch" href="/personal-blog/assets/js/38.d4143a9b.js"><link rel="prefetch" href="/personal-blog/assets/js/39.cbf8706b.js"><link rel="prefetch" href="/personal-blog/assets/js/4.259d316e.js"><link rel="prefetch" href="/personal-blog/assets/js/40.0e604561.js"><link rel="prefetch" href="/personal-blog/assets/js/41.a1534c49.js"><link rel="prefetch" href="/personal-blog/assets/js/42.0d587eef.js"><link rel="prefetch" href="/personal-blog/assets/js/43.5cc8c98d.js"><link rel="prefetch" href="/personal-blog/assets/js/44.3c99b17d.js"><link rel="prefetch" href="/personal-blog/assets/js/45.344a2af8.js"><link rel="prefetch" href="/personal-blog/assets/js/46.01472961.js"><link rel="prefetch" href="/personal-blog/assets/js/47.444aebbd.js"><link rel="prefetch" href="/personal-blog/assets/js/48.632cd1e7.js"><link rel="prefetch" href="/personal-blog/assets/js/49.33be5536.js"><link rel="prefetch" href="/personal-blog/assets/js/5.deb8d1a0.js"><link rel="prefetch" href="/personal-blog/assets/js/50.606a2040.js"><link rel="prefetch" href="/personal-blog/assets/js/51.05f600f7.js"><link rel="prefetch" href="/personal-blog/assets/js/52.3014bb9a.js"><link rel="prefetch" href="/personal-blog/assets/js/53.20d8d668.js"><link rel="prefetch" href="/personal-blog/assets/js/54.9018d328.js"><link rel="prefetch" href="/personal-blog/assets/js/55.45598492.js"><link rel="prefetch" href="/personal-blog/assets/js/56.fdf84c1e.js"><link rel="prefetch" href="/personal-blog/assets/js/57.c76e2e74.js"><link rel="prefetch" href="/personal-blog/assets/js/58.eaea0a62.js"><link rel="prefetch" href="/personal-blog/assets/js/59.b90b8b20.js"><link rel="prefetch" href="/personal-blog/assets/js/6.3d2d0cab.js"><link rel="prefetch" href="/personal-blog/assets/js/60.d0971935.js"><link rel="prefetch" href="/personal-blog/assets/js/61.61cec365.js"><link rel="prefetch" href="/personal-blog/assets/js/62.71b24778.js"><link rel="prefetch" href="/personal-blog/assets/js/63.629db0e5.js"><link rel="prefetch" href="/personal-blog/assets/js/64.2c6aa57e.js"><link rel="prefetch" href="/personal-blog/assets/js/65.6e809847.js"><link rel="prefetch" href="/personal-blog/assets/js/66.6013dc5e.js"><link rel="prefetch" href="/personal-blog/assets/js/67.149d811b.js"><link rel="prefetch" href="/personal-blog/assets/js/68.b9b54b8e.js"><link rel="prefetch" href="/personal-blog/assets/js/69.acd1d986.js"><link rel="prefetch" href="/personal-blog/assets/js/7.8a0c691b.js"><link rel="prefetch" href="/personal-blog/assets/js/70.41b336f0.js"><link rel="prefetch" href="/personal-blog/assets/js/71.41207ba7.js"><link rel="prefetch" href="/personal-blog/assets/js/72.771d5928.js"><link rel="prefetch" href="/personal-blog/assets/js/73.3e4e9451.js"><link rel="prefetch" href="/personal-blog/assets/js/74.f992e12a.js"><link rel="prefetch" href="/personal-blog/assets/js/75.10091b4a.js"><link rel="prefetch" href="/personal-blog/assets/js/76.00accf95.js"><link rel="prefetch" href="/personal-blog/assets/js/77.2b4d5166.js"><link rel="prefetch" href="/personal-blog/assets/js/78.46db8679.js"><link rel="prefetch" href="/personal-blog/assets/js/79.26e0c54e.js"><link rel="prefetch" href="/personal-blog/assets/js/8.a081ae6a.js"><link rel="prefetch" href="/personal-blog/assets/js/80.f72a7a66.js"><link rel="prefetch" href="/personal-blog/assets/js/81.e18a09e7.js"><link rel="prefetch" href="/personal-blog/assets/js/82.ddbfcc86.js"><link rel="prefetch" href="/personal-blog/assets/js/83.9e64ea56.js"><link rel="prefetch" href="/personal-blog/assets/js/84.91ca4865.js"><link rel="prefetch" href="/personal-blog/assets/js/85.c464b716.js"><link rel="prefetch" href="/personal-blog/assets/js/86.23c160fc.js"><link rel="prefetch" href="/personal-blog/assets/js/87.4ae1aecd.js"><link rel="prefetch" href="/personal-blog/assets/js/88.7450a3d3.js"><link rel="prefetch" href="/personal-blog/assets/js/89.e2e6f0fc.js"><link rel="prefetch" href="/personal-blog/assets/js/9.4f397964.js"><link rel="prefetch" href="/personal-blog/assets/js/90.0475b297.js"><link rel="prefetch" href="/personal-blog/assets/js/91.2c895556.js"><link rel="prefetch" href="/personal-blog/assets/js/92.28dda5ea.js"><link rel="prefetch" href="/personal-blog/assets/js/93.00e90601.js"><link rel="prefetch" href="/personal-blog/assets/js/94.c153f9e1.js"><link rel="prefetch" href="/personal-blog/assets/js/95.4fea4bbf.js"><link rel="prefetch" href="/personal-blog/assets/js/96.dbabeeae.js"><link rel="prefetch" href="/personal-blog/assets/js/97.dfec418f.js"><link rel="prefetch" href="/personal-blog/assets/js/98.3494a8dd.js"><link rel="prefetch" href="/personal-blog/assets/js/99.7da7ab72.js">
    <link rel="stylesheet" href="/personal-blog/assets/css/0.styles.196d8624.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/personal-blog/" class="home-link router-link-active"><!----> <span class="site-name">戡玉的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/personal-blog/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/personal-blog/code/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/personal-blog/about/" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/personal-blog/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/personal-blog/code/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/personal-blog/about/" class="nav-link">
  关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>web前端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/personal-blog/code/article/front-end/1.html" class="sidebar-link">web 常用知识</a></li><li><a href="/personal-blog/code/article/front-end/2.html" class="sidebar-link">ajax 基础知识</a></li><li><a href="/personal-blog/code/article/front-end/3.html" class="sidebar-link">web 前端性能优化</a></li><li><a href="/personal-blog/code/article/front-end/4.html" class="sidebar-link">前端 seo 处理</a></li><li><a href="/personal-blog/code/article/front-end/5.html" aria-current="page" class="active sidebar-link">npm 相关知识整理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#语义化版本" class="sidebar-link">语义化版本</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#依赖版本号" class="sidebar-link">依赖版本号</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#package-入口" class="sidebar-link">package 入口</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#package-lock" class="sidebar-link">package-lock</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-脚本原理" class="sidebar-link">npm 脚本原理</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-脚本执行" class="sidebar-link">npm 脚本执行</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-常用别名" class="sidebar-link">npm 常用别名</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-发布" class="sidebar-link">npm 发布</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-变量" class="sidebar-link">npm 变量</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-依赖" class="sidebar-link">npm 依赖</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-钩子" class="sidebar-link">npm 钩子</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npx-命令" class="sidebar-link">npx 命令</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-init-命令" class="sidebar-link">npm init 命令</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#npm-link-命令" class="sidebar-link">npm link 命令</a></li><li class="sidebar-sub-header"><a href="/personal-blog/code/article/front-end/5.html#参考文章" class="sidebar-link">参考文章</a></li></ul></li><li><a href="/personal-blog/code/article/front-end/6.html" class="sidebar-link">前端 excel 导出</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>游览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="npm-相关知识整理"><a href="#npm-相关知识整理" class="header-anchor">#</a> npm 相关知识整理</h1> <h2 id="语义化版本"><a href="#语义化版本" class="header-anchor">#</a> 语义化版本</h2> <ul><li><p>major: 重大变化，不兼容老版本</p></li> <li><p>minor: 新增功能，兼容老版本</p></li> <li><p>patch: 修复 bug，兼容老版本</p></li></ul> <h2 id="依赖版本号"><a href="#依赖版本号" class="header-anchor">#</a> 依赖版本号</h2> <ul><li><p>* 匹配最新版本的依赖</p></li> <li><p>^ 匹配最近的大版本依赖，比如^1.2.3，会匹配所有 1.x.x 的包，不包括 2.0.0</p></li> <li><p>~ 会匹配最近的小版本依赖，比如~1.2.3，会匹配所有 1.2.x 版本，不包括 1.3.0</p></li></ul> <h2 id="package-入口"><a href="#package-入口" class="header-anchor">#</a> package 入口</h2> <p>如果使用 import 对库进行导入，会优先寻找 module 字段引入，然后才是 main 字段。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;midash&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// es module入口</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.mjs&quot;</span> <span class="token comment">// commonjs入口</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="package-lock"><a href="#package-lock" class="header-anchor">#</a> package-lock</h2> <h3 id="锁定规则"><a href="#锁定规则" class="header-anchor">#</a> 锁定规则</h3> <ul><li><p>当 package-lock.json 中的依赖锁定版本符合 package.json 中的版本号范围时，将以 package-lock.json 锁死版本号为主。</p></li> <li><p>当 package-lock.json 中的依赖锁定版本不符合 package.json 中的版本号范围时，将会安装符合 package.json 版本号范围的最新版本号依赖，并重写 package-lock.json 文件</p></li></ul> <h3 id="要不要提交-package-lock"><a href="#要不要提交-package-lock" class="header-anchor">#</a> 要不要提交 package-lock</h3> <ul><li><p><strong>对于项目开发而言，有必要</strong>。当有了 lock 文件时，每一个依赖的版本号都被锁死在了 lock 文件，每次依赖安装的版本号都从 lock 文件中进行获取，避免了不可测的依赖风险。</p></li> <li><p><strong>对于库开发而言，也有必要</strong>。虽然项目中所有依赖都会根据项目 lockfile 锁死而并不会依照库依赖的 lockfile，但是为了贡献者能很容易地将项目跑起来，devDependencies 必须在库的 lockfile 中锁定。</p></li></ul> <h2 id="npm-脚本原理"><a href="#npm-脚本原理" class="header-anchor">#</a> npm 脚本原理</h2> <ul><li>每当执行 npm run xx，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。因此，只要是 Shell 可以运行的命令，一般是 Bash，就可以写在 npm 脚本里面。</li> <li>npm run 新建的这个 Shell，会将当前目录的 node_modules/.bin 子目录加入 PATH 变量，执行结束后，再将 PATH 变量恢复原样，这也就是为什么 npm run 指向的命令能够被执行的原因。</li></ul> <h2 id="npm-脚本执行"><a href="#npm-脚本执行" class="header-anchor">#</a> npm 脚本执行</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run script1.js &amp; npm run script2.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 并行执行（同时执行）</span>
    <span class="token property">&quot;abc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run script1.js &amp;&amp; npm run script2.js&quot;</span> <span class="token comment">// 继发执行（即只有前一个任务成功，才执行下一个任务）</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Windows 下不支持这 2 种方式，可以通过安装 npm-run-all、Concurrently 模块解决。</p> <h2 id="npm-常用别名"><a href="#npm-常用别名" class="header-anchor">#</a> npm 常用别名</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">add</span> -<span class="token operator">&gt;</span> <span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> create -<span class="token operator">&gt;</span> <span class="token function">npm</span> init
</code></pre></div><h2 id="npm-发布"><a href="#npm-发布" class="header-anchor">#</a> npm 发布</h2> <ol><li>第一步，在<a href="https://github.com/pandao/editor.md" target="_blank" rel="noopener noreferrer">npm 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进行注册一个账号。</li> <li>第二步，执行 npm login，输入注册的账号密码完成登录。</li> <li>第三步，npm i -y 初始化 package 文件，填入最基本的 3 个字段：name，version 和 main 字段，其中 main 字段应该是打包后的代码。</li> <li>第四步，在包目录执行 npm publish</li></ol> <h2 id="npm-变量"><a href="#npm-变量" class="header-anchor">#</a> npm 变量</h2> <p>通过 npm<em>package</em>前缀，js 脚本可以通过 process.env 对象拿到 package.json 里面的字段。比如，下面这个 package.json：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.5&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node view.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// view.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_version<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.2.5</span>
</code></pre></div><p>npm<em>package</em>前缀也支持嵌套的 package.json 字段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// view.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_scripts_view<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// node view.js</span>
</code></pre></div><h2 id="npm-依赖"><a href="#npm-依赖" class="header-anchor">#</a> npm 依赖</h2> <ul><li><p>dependencies 生产依赖</p></li> <li><p>devDependencies 开发依赖</p></li></ul> <h3 id="安装命令"><a href="#安装命令" class="header-anchor">#</a> 安装命令</h3> <div class="language-json extra-class"><pre class="language-json"><code>npm i --save xxx <span class="token comment">// 生产依赖</span>
npm i --save-dev <span class="token comment">// 开发依赖</span>

npm i -S xxx <span class="token comment">// 生产依赖（简写）</span>
npm i -D xxx <span class="token comment">// 开发依赖（简写）</span>
</code></pre></div><h3 id="是否要严格区分生产和开发"><a href="#是否要严格区分生产和开发" class="header-anchor">#</a> 是否要严格区分生产和开发？</h3> <ul><li><p><strong>当进行项目开发时，并无必要</strong>。因为打包时，依靠的是 Webpack/Rollup 对代码进行模块依赖分析，与该模块是否在 dep/devDep 并无关系，只要在 node_modules 上能够找到该依赖即可。</p></li> <li><p><strong>当进行库开发时，有必要</strong>。因为当在项目中安装一个依赖库时，只有该依赖的 dependencies 会被安装到 node_modules 中，devDependencies 不会，因此这里如果不区分，会导致开发项目报错受影响。</p></li></ul> <h2 id="npm-钩子"><a href="#npm-钩子" class="header-anchor">#</a> npm 钩子</h2> <p>npm 钩子，也称 npm 生命周期。npm 默认提供 pre 和 post 两个钩子，当我们执行任意 npm run 脚本时，都将自动触发 pre/post 的钩子但是这 2 个钩子的内容需要由你自定义。</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;scripts&quot;: {
    &quot;preabc&quot;: &quot;xxx&quot;,
    &quot;abc&quot;: &quot;xxx&quot;,
    &quot;postabc&quot;: &quot;xxx&quot;
  }
}
</code></pre></div><p>当你执行 npm run abc 时，会自动按照下面的顺序执行</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> run preabc -<span class="token operator">&gt;</span> <span class="token function">npm</span> run abc -<span class="token operator">&gt;</span> <span class="token function">npm</span> run postabc
</code></pre></div><p>一些常用 npm 脚本，如：publish、install、uninstall、version、test、stop、start 和 restart，同样支持自定义这 2 个钩子。</p> <h3 id="npm-restart"><a href="#npm-restart" class="header-anchor">#</a> npm restart</h3> <p>npm restart 是一个复合命令，实际上会执行三个脚本命令：stop、restart、start。具体的执行顺序如下：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>prerestart
prestop
stop
poststop
restart
prestart
start
poststart
postrestart
</code></pre></div><h3 id="npm-publish"><a href="#npm-publish" class="header-anchor">#</a> npm publish</h3> <p>npm publish 发包的生命周期比较复杂，当执行 npm publish 命令，将自动执行以下脚本：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>prepublishOnly: 最重要的一个生命周期，如果你需要在发包之前自动做一些事情，如测试、构建等，可以在这里完成。
prepack
prepare
postpack
publish
postpublish
</code></pre></div><h3 id="prepare-钩子"><a href="#prepare-钩子" class="header-anchor">#</a> prepare 钩子</h3> <p>一个最常用的生命周期钩子，它的执行时机：</p> <ul><li><p>npm install 之后自动执行</p></li> <li><p>npm publish 之前自动执行</p></li></ul> <p>常用的 git hook 工具 husky 通常就被放置在这个钩子里执行</p> <div class="language- extra-class"><pre class="language-text"><code>{
  prepare: &quot;husky install&quot;;
}
</code></pre></div><h3 id="npm-lifecycle-event-变量"><a href="#npm-lifecycle-event-变量" class="header-anchor">#</a> npm_lifecycle_event 变量</h3> <p>npm 提供一个 npm_lifecycle_event 变量，返回当前正在运行的脚本名称，比如 pretest、test、posttest 等等。所以，可以利用这个变量，在同一个脚本文件里面，为不同的 npm scripts 命令编写代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">TARGET</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_lifecycle_event<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">TARGET</span> <span class="token operator">===</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Running the test task!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">TARGET</span> <span class="token operator">===</span> <span class="token string">&quot;pretest&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Running the pretest task!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">TARGET</span> <span class="token operator">===</span> <span class="token string">&quot;posttest&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Running the posttest task!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="npx-命令"><a href="#npx-命令" class="header-anchor">#</a> npx 命令</h2> <p>npm 从 5.2 版开始，增加了 npx 命令，可以提升开发者使用包内提供的命令行工具的体验，它有很多用处。</p> <h3 id="方便调用项目安装的模块"><a href="#方便调用项目安装的模块" class="header-anchor">#</a> 方便调用项目安装的模块</h3> <p>通常我们安装完 npm 依赖或脚手架后，需要将其写入 package.json 的 scripts 字段里面，运行 npm run xxx 才能执行，npx 就是想解决这个问题，利用 npx，我们可以直接调用运行。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build-bundle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build --target lib --name t3-ui ./src/components/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service lint&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们用 npx 命令的话， 就不需要在写 scripts 里面的内容， 直接在控制台执行 npx vue-cli-service serve，就会直接寻找本地依赖并执行。</p> <h3 id="避免全局安装模块"><a href="#避免全局安装模块" class="header-anchor">#</a> 避免全局安装模块</h3> <p>运行 npx 命令后，npx 会将依赖下载到一个临时目录，使用以后再删除</p> <div class="language-sh extra-class"><pre class="language-sh"><code>npx uglify-js@3.1.0 main.js -o ./dist/main.js // 临时下载压缩包，执行压缩
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>npx http-server // 临时在当前目录，安装并运行起本地服务器
</code></pre></div><h3 id="使用不同版本的-node"><a href="#使用不同版本的-node" class="header-anchor">#</a> 使用不同版本的 node</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>npx -p node@6 <span class="token function">npm</span> run serve
</code></pre></div><p>执行逻辑如下：</p> <ul><li>npx 下载 node@6 版本</li> <li>将执行的 node 版本切换为 node@6 版本</li> <li>使用 node@6 执行 npm run serve</li> <li>命令执行完毕后，删除下载包，最终不会改变本地的使用版本</li></ul> <h3 id="npx-命令执行逻辑"><a href="#npx-命令执行逻辑" class="header-anchor">#</a> npx 命令执行逻辑</h3> <p>先自动查找当前依赖包中的可执行文件，如果找不到，就会去 PATH 里找，如果依然找不到，就会帮你临时安装，执行完后再删除包。</p> <h2 id="npm-init-命令"><a href="#npm-init-命令" class="header-anchor">#</a> npm init 命令</h2> <p>命令用法：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> init <span class="token punctuation">[</span>--force<span class="token operator">|</span>-f<span class="token operator">|</span>--yes<span class="token operator">|</span>-y<span class="token operator">|</span>--scope<span class="token punctuation">]</span>
<span class="token function">npm</span> init <span class="token operator">&lt;</span>@scope<span class="token operator">&gt;</span> <span class="token punctuation">(</span>same as <span class="token variable"><span class="token variable">`</span>npx <span class="token operator">&lt;</span>@scope<span class="token operator">&gt;</span>/create<span class="token variable">`</span></span><span class="token punctuation">)</span>
<span class="token function">npm</span> init <span class="token punctuation">[</span><span class="token operator">&lt;</span>@scope<span class="token operator">&gt;</span>/<span class="token punctuation">]</span><span class="token operator">&lt;</span>name<span class="token operator">&gt;</span> <span class="token punctuation">(</span>same as <span class="token variable"><span class="token variable">`</span>npx <span class="token punctuation">[</span><span class="token operator">&lt;</span>@scope<span class="token operator">&gt;</span>/<span class="token punctuation">]</span>create-<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span><span class="token variable">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p>npm init xxx 时，会自动转换成如下 npx 命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> init foo -<span class="token operator">&gt;</span> npx create-foo
<span class="token function">npm</span> init @usr/foo -<span class="token operator">&gt;</span> npx @usr/create-foo
<span class="token function">npm</span> init @usr -<span class="token operator">&gt;</span> npx @usr/create
</code></pre></div><p>以 vue3 官方安装为例，命令实际效果如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实际安装的是create-vue@latest包</span>
npm init vue@latest <span class="token operator">-</span><span class="token operator">&gt;</span> npx create<span class="token operator">-</span>vue@latest
</code></pre></div><p>npm exec 命令和 npx 作用相同，区别仅在于后者会将其后面的标志和选项都会优先设置为位置参数，具体可对照 npm 文档。</p> <h2 id="npm-link-命令"><a href="#npm-link-命令" class="header-anchor">#</a> npm link 命令</h2> <p>简而言之，就是可以将你本地的 npm 开发包当作是已经 npm install 好后的包使用了，用来在本地项目和本地 npm 模块之间建立连接，方便关联到项目中进行修改/调试。</p> <h3 id="局部-link"><a href="#局部-link" class="header-anchor">#</a> 局部 link</h3> <div class="language-js extra-class"><pre class="language-js"><code>cd projectPath
npm link <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>module   <span class="token comment">// 然后，你本地项目的node_modules就出现了该module的软链接</span>
</code></pre></div><h3 id="全局-link"><a href="#全局-link" class="header-anchor">#</a> 全局 link</h3> <p>1.注入全局 link</p> <div class="language-js extra-class"><pre class="language-js"><code>cd modulePath
npm link <span class="token comment">// 然后，全局node_modules目录下就出现该module的软链接</span>
</code></pre></div><p>2.引入全局 link</p> <div class="language-js extra-class"><pre class="language-js"><code>cd projectPath
npm link module
</code></pre></div><h3 id="解除-link"><a href="#解除-link" class="header-anchor">#</a> 解除 link</h3> <p>解除局部 link</p> <div class="language- extra-class"><pre class="language-text"><code>cd projectPath
npm unlink module
</code></pre></div><p>解除全局 link</p> <div class="language- extra-class"><pre class="language-text"><code>cd modulePath
npm unlink moduleName
</code></pre></div><h3 id="以-vite-为例"><a href="#以-vite-为例" class="header-anchor">#</a> 以 vite 为例</h3> <p>如果你迫不及待想要体验最新的功能，可以自行克隆 vite 仓库，然后到本地机器上然后自行将其链接</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第1步，克隆并进入目录</span>
git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>vitejs<span class="token operator">/</span>vite<span class="token punctuation">.</span>git
cd vite

<span class="token comment">// 第2步，安装vite作为npm开发包的依赖，然后打包出开发者需要的vite</span>
pnpm install
cd packages<span class="token operator">/</span>vite
npm run build

<span class="token comment">// 第3步，全局注入link</span>
npm link

<span class="token comment">// 第4步，进入本地项目，引入link，这个时候就相当于全局安装了vite，类似于执行了vite官方安装命令：npm create vite@latest</span>
pnpm link <span class="token operator">--</span>global vite

<span class="token comment">// 第5步，package文件的script内dev写入vite命令</span>
<span class="token literal-property property">dev</span><span class="token operator">:</span> <span class="token string">'vite'</span>

<span class="token comment">// 第6步，执行npm命令</span>
npm run dev
</code></pre></div><p>实际测试发现，使用 link 后，第 5 和第 6 步是多余的，本地可以直接在控制台使用 vite 命令，不管你是全局 link 的，还是局部 link 的，都可以运行。</p> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <ul><li>https://q.shanyue.tech/engineering/</li> <li>https://www.ruanyifeng.com/blog/2016/10/npm_scripts.html</li> <li>https://www.ruanyifeng.com/blog/2019/02/npx.html</li> <li>https://segmentfault.com/a/1190000020082099</li> <li>https://blog.csdn.net/xuewenjie0217/article/details/123008562</li> <li>https://blog.csdn.net/lw001x/article/details/124133735</li> <li>https://juejin.cn/post/7018344866811740173</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/personal-blog/code/article/front-end/4.html" class="prev">
        前端 seo 处理
      </a></span> <span class="next"><a href="/personal-blog/code/article/front-end/6.html">
        前端 excel 导出
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/personal-blog/assets/js/app.8eae075c.js" defer></script><script src="/personal-blog/assets/js/2.b85b6bc1.js" defer></script><script src="/personal-blog/assets/js/17.8cc42dcc.js" defer></script>
  </body>
</html>
